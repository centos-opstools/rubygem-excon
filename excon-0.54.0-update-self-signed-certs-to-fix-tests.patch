From 6a6a30ac9e68ea54f7fd4774bf304074bfd4e505 Mon Sep 17 00:00:00 2001
From: geemus <geemus@gmail.com>
Date: Tue, 6 Dec 2016 10:17:08 -0600
Subject: [PATCH] update self-signed certs to fix tests

---
 Rakefile                      |  6 ++++++
 tests/basic_tests.rb          |  2 +-
 tests/data/127.0.0.1.cert.crt | 29 +++++++++++++++++------------
 tests/data/127.0.0.1.cert.key | 43 ++++++++++++++++++++++++++++---------------
 tests/data/excon.cert.crt     | 29 +++++++++++++++++------------
 tests/data/excon.cert.key     | 43 ++++++++++++++++++++++++++++---------------
 6 files changed, 97 insertions(+), 55 deletions(-)

diff --git a/Rakefile b/Rakefile
index 08a520e..39c8e8a 100644
--- a/Rakefile
+++ b/Rakefile
@@ -146,13 +146,19 @@ end
 
 desc "update bundled certs"
 task :update_certs do
+  # update curl bundle for end-users
   require File.join(File.dirname(__FILE__), 'lib', 'excon')
   File.open(File.join(File.dirname(__FILE__), 'data', 'cacert.pem'), 'w') do |file|
     data = Excon.get("https://curl.haxx.se/ca/cacert.pem").body
     file.write(data)
   end
+
+  # update self-signed certs for tests
+  sh "openssl req -subj '/CN=excon/O=excon' -new -newkey rsa:2048 -sha256 -days 365 -nodes -x509 -keyout tests/data/excon.cert.key -out tests/data/excon.cert.crt"
+  sh "openssl req -subj '/CN=127.0.0.1/O=excon' -new -newkey rsa:2048 -sha256 -days 365 -nodes -x509 -keyout tests/data/127.0.0.1.cert.key -out tests/data/127.0.0.1.cert.crt"
 end
 
+
 desc "check ssl settings"
 task :hows_my_ssl do
   require File.join(File.dirname(__FILE__), 'lib', 'excon')
diff --git a/tests/basic_tests.rb b/tests/basic_tests.rb
index f8ee529..ab6ba26 100644
--- a/tests/basic_tests.rb
+++ b/tests/basic_tests.rb
@@ -156,7 +156,7 @@ def timed_streaming_test(endpoint, timeout)
     connection = nil
     test do
       ssl_ca_file = File.join(File.dirname(__FILE__), 'data', 'excon.cert.crt')
-      connection = Excon.new('https://127.0.0.1:9443', :ssl_verify_peer => true, :ssl_ca_file => ssl_ca_file, :ssl_verify_peer_host => 'Excon' )
+      connection = Excon.new('https://127.0.0.1:9443', :ssl_verify_peer => true, :ssl_ca_file => ssl_ca_file, :ssl_verify_peer_host => 'excon' )
       true
     end
 
diff --git a/tests/data/127.0.0.1.cert.crt b/tests/data/127.0.0.1.cert.crt
index b2684a9..b48e20f 100644
--- a/tests/data/127.0.0.1.cert.crt
+++ b/tests/data/127.0.0.1.cert.crt
@@ -1,14 +1,19 @@
 -----BEGIN CERTIFICATE-----
-MIICEzCCAXwCCQC94mWSE0+JcjANBgkqhkiG9w0BAQUFADBOMQswCQYDVQQGEwJV
-UzELMAkGA1UECBMCQ0ExDjAMBgNVBAoTBUV4Y29uMQ4wDAYDVQQLEwVFeGNvbjES
-MBAGA1UEAxMJMTI3LjAuMC4xMB4XDTE0MTAyODIwMjMzMVoXDTE5MTAyNzIwMjMz
-MVowTjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMQ4wDAYDVQQKEwVFeGNvbjEO
-MAwGA1UECxMFRXhjb24xEjAQBgNVBAMTCTEyNy4wLjAuMTCBnzANBgkqhkiG9w0B
-AQEFAAOBjQAwgYkCgYEAvqlKlQMoS4q9jgsm+sBh7B9jEJVYHqNBluqgLubMEmjs
-xFZUIicx+LmMPfUdnqtGDihR7q3yh/xeJuzzux38FBwTBDl8NRXWSyRkJqdi9XUA
-qihAlkqDoZ6Eb867isF7C5FEqohAuCE0FUaYU1HY3bV/foLqxEbyvQVwaRZ4rjkC
-AwEAATANBgkqhkiG9w0BAQUFAAOBgQCRxnrtbFJrBT4duYtOVuG/j8G46bf1DPrF
-wuRf38gdO2Ldu+kdNRMhQrgSA9CfkjwwQpcVK2gZTuGTdmtqTnvIKilsomtG3tFK
-ThWxuW6HrU9XgZ5KXIguVnL5tjYBNslsCFiQUeU/b8GF2MyMkOGUIC0p411ZB9v/
-mTKRgzf/qQ==
+MIIDGzCCAgOgAwIBAgIJAIXiQSrKm3uVMA0GCSqGSIb3DQEBCwUAMCQxEjAQBgNV
+BAMMCTEyNy4wLjAuMTEOMAwGA1UECgwFZXhjb24wHhcNMTYxMjA2MTYxMjQyWhcN
+MTcxMjA2MTYxMjQyWjAkMRIwEAYDVQQDDAkxMjcuMC4wLjExDjAMBgNVBAoMBWV4
+Y29uMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAt/IvVdD8BnCmsZ7g
+3I0vjwd0cY5PJr7DR5NFY9uDQVLZSyg4Q5N5n4MyAR2pCUWEeHwtnW+2c8R2rB0Q
+HLV0xdmH9jfYP7q7bljiu67F8Js5YFP3w0qzyW6nIiYuNSn+CCIvG2IotLT5sKFd
+z6SsG5JOz+pIlpfiW2rC4wQvzoeE8MpHzojaooIcavIng6F6tUL0xEHobcDMsUXl
+uwsZ5D7ZGWZ1arW7ajY4thM1wppDq79hv4lthY4ZOD1yZxFrFP61n76kz47oweQj
+4bKILO/xyGPwyJVLOzGu/CnIA0fuBnJ5+UyID4/HkZaxqtx3FSbJc9e3DLSXfAcH
+UA3EfwIDAQABo1AwTjAdBgNVHQ4EFgQUwrCnuVSwfDPiV3g8s6no94lyGKMwHwYD
+VR0jBBgwFoAUwrCnuVSwfDPiV3g8s6no94lyGKMwDAYDVR0TBAUwAwEB/zANBgkq
+hkiG9w0BAQsFAAOCAQEAr/7DaM6w2iHz/auJox5bNq0/JsUnKAx+YYOr+LNwbipL
+fpWvh3a5xTQNZMzeIPahXBPitzxUCx5FvrWIX/ovxH8LlJ9OlvEbAe/WiIDqqGjj
+0ywdou4pLI3VmYPf8t+OzEQnge4qTQm6T+SVzpYNtiSLB3FP68U7UWgTkHNcm6Zl
+uA88wTzVYAtR8NlfBdN12lwDet7looSmSB11drzjrvg67TmRpc9E3YWHEbE6F7wi
+8LJUBEvYmPoctmE4NQrSn9YKrzeFFXsfH19ksYE5QKDZgn1Cgjl9XKYY6fbMF7P1
+COYROHlNg2MJV+X3CU3hHmYB7uj249IPqutvRjto9w==
 -----END CERTIFICATE-----
diff --git a/tests/data/127.0.0.1.cert.key b/tests/data/127.0.0.1.cert.key
index 9e8a2c9..e06cd27 100644
--- a/tests/data/127.0.0.1.cert.key
+++ b/tests/data/127.0.0.1.cert.key
@@ -1,15 +1,28 @@
------BEGIN RSA PRIVATE KEY-----
-MIICXQIBAAKBgQC+qUqVAyhLir2OCyb6wGHsH2MQlVgeo0GW6qAu5swSaOzEVlQi
-JzH4uYw99R2eq0YOKFHurfKH/F4m7PO7HfwUHBMEOXw1FdZLJGQmp2L1dQCqKECW
-SoOhnoRvzruKwXsLkUSqiEC4ITQVRphTUdjdtX9+gurERvK9BXBpFniuOQIDAQAB
-AoGAEwJB41VrQQzWFUFbY4imuqnucIrTPEq+kVNXIRX1pqg7Yt/Qh48s1kV5i/vS
-Ni2RUHwInylMku5AXNUm/7LfnN1zCHiYVkddL6df73BdzKfM86j+eQJdqye3AOkZ
-GKrutsE8AEwOBCPtM9z3EbbAQZQpBBGyvAH3z8/GFLa34LkCQQDwEhEJleUGxiSR
-anm43iFWsNBqW680YSz3kh1O7aC+09u8BOvOJ6azOMBYgxBno0IR9Oe7k0iBl+8e
-YJmAuCVHAkEAy0/wdYeKwv9Dd3y9I+lS11VvaQaY2dmFmhbkPl/AAjUHju5ZF7me
-Znwpq0jLlKRlKatVjkO/mkOeWs1/8MhQfwJBAO5VkVKJ3IjAF7fCFDvjUwfEm/Sr
-NyJyQvk5tx0PrqEkpSZhYFUXaljNQ6/b1mJ9Yu9+yrye+MGnu73Vuy9eIasCQFT4
-fejA0y+X+5xul6Xwl9zDKiLczPkPPhUeSBoBbn/9pcEIwFd4DkmKzud1LxBafKUj
-pEgm7GcOp5oPlM8PCQUCQQCtPFpgobUK9nRewxWagUL+xlEo6C1CPFhTwtQvnyi9
-6UwgxZtOdzAc3xRvHo4uK3OwGuOklqkpIeiZg3hoZb6B
------END RSA PRIVATE KEY-----
+-----BEGIN PRIVATE KEY-----
+MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC38i9V0PwGcKax
+nuDcjS+PB3Rxjk8mvsNHk0Vj24NBUtlLKDhDk3mfgzIBHakJRYR4fC2db7ZzxHas
+HRActXTF2Yf2N9g/urtuWOK7rsXwmzlgU/fDSrPJbqciJi41Kf4IIi8bYii0tPmw
+oV3PpKwbkk7P6kiWl+JbasLjBC/Oh4TwykfOiNqighxq8ieDoXq1QvTEQehtwMyx
+ReW7CxnkPtkZZnVqtbtqNji2EzXCmkOrv2G/iW2Fjhk4PXJnEWsU/rWfvqTPjujB
+5CPhsogs7/HIY/DIlUs7Ma78KcgDR+4Gcnn5TIgPj8eRlrGq3HcVJslz17cMtJd8
+BwdQDcR/AgMBAAECggEAVosZfjSu/pCtvM/VV68Neyu0u2CLGN2Tnu9JLGww2uER
+3uxzXEfcZxIgyqmbyALvCojSJUpT+y+p7dxWoks1P4jTESLBGWrPmGE1e7wE4OkH
+G60l2rog0FrBQ63W+6hgHo+Gvkl2gV7MQzAIpRMC7o3tiqDdugyHsR8PxiNIItCO
+3kDoWSFtcXYVdsoXQM9fjlcHgVzplohmQPPxF15dRY+jg4CUju5N857FCOWx+4W+
+rt+snQyPHwG3/FFy6TEosK+p85ZZmE/l+Zk8hjm+iXlR9WsGVWPBQBzW0IcHuMcb
+len/RIZpFnvtF0BMAeiBJ1Fu6ddsLp+d94YKe4hygQKBgQDs5xC7Alqmt0dyjAm0
+C7vNbfv4XhppAfveEFYIVeQk5hcYRlgx5OYfPwxxx88Q+RROXYJB+Cyb5UoLkUYV
+HrLfjnXIZ9gmvkJpFTaQiq6PokTORHdj85t80VB9au1FtO4bF/bx9KqxTPJ+cOKC
+07qtPGNGQKNw5HayT0WsmgmoYQKBgQDGxkKnIgOKKHj1QBneCDTYwLjD1shoyvuS
+pF9iSoFuvdpdYkpB3cLAGkDWBwjsPKX4lpnAV/MX1fWnFSD7qAOIozV24WK0ehBz
+1tyEWZqKAiSb/tOPxIC7zOlSiJpgEWuJ3GLyL7mWW8EbNHxL6gH24Y885ngwQTep
+1eTsG7sY3wKBgBpz+sRHEQRItuutg2/dV40q2NX0/BH5rLwxKsonfSA5qR6GzFZV
+7vRSP/t8ijyk84WEn4TqR2DpC4mbIS4+jU61Q6WrItHAsP225q7hLXjQb8pwjrxU
+eWpInSpEBFaiS2wvEt4VqfG+W92OkVx2dAPgGF3B3f4/JJnojCkn0ihBAoGBAK2O
+Ekhn1HtfFy3cCDnrJGlU7H5iHJ4TDVFen8Hsl9KfhfgfiAK2pAKjaZT2k33g/nFs
+3VYp9KENOe3m7uOMMXmuN1JTPKGkKpVaNzSAIAT8Fgb2mrZetqBDLD3Z9CCJVUIL
+4YDg1sRH3PXp/9UwvwJWs4BTIwHPD9EEZ1sYY2Y1AoGAZWgdTgA9q/UCdGh29Nea
+6r6mKtXDaSycsJDIPfxLXSAeWF/hBHqHbGGzbgqjo7MsprHB1gV8NSMC1rqH2BJb
+qUbqWLdhp46FQe2i9Cg86irQ7zEqrYiw/J8hB3+KDYVNkvhj04CS+Gydmr4t6x7P
+pUe5CcWJcL9M0X6ob4lMy7o=
+-----END PRIVATE KEY-----
diff --git a/tests/data/excon.cert.crt b/tests/data/excon.cert.crt
index 8218e49..fc7793d 100644
--- a/tests/data/excon.cert.crt
+++ b/tests/data/excon.cert.crt
@@ -1,14 +1,19 @@
 -----BEGIN CERTIFICATE-----
-MIICLzCCAZgCCQCidUHPgYe2GTANBgkqhkiG9w0BAQUFADBcMQswCQYDVQQGEwJV
-UzELMAkGA1UECBMCQ0ExDjAMBgNVBAoTBUV4Y29uMQ4wDAYDVQQDEwVFeGNvbjEg
-MB4GCSqGSIb3DQEJARYRYWRtaW5AZXhhbXBsZS5jb20wHhcNMTMwMjI4MTczOTE4
-WhcNMTYxMTI0MTczOTE4WjBcMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExDjAM
-BgNVBAoTBUV4Y29uMQ4wDAYDVQQDEwVFeGNvbjEgMB4GCSqGSIb3DQEJARYRYWRt
-aW5AZXhhbXBsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKM+fgjX
-QfkMpepEWQBO7pJLQgoYY0EntYSgmFF/9E+fcokCWAHtmF5SBtpbWJRz3BcZ/bfq
-zYYlbTAWu3nsXwsp/6Fn4dv1jvUAreAH3QV4nm8kU8FcoQ8O085UruEHIDTpZec2
-hBLTcU7dDbxAdMJLZSpkxi75I8iB9+PKGYfRAgMBAAEwDQYJKoZIhvcNAQEFBQAD
-gYEAMJvD5vR3k3EkWodu318aQEgQWpy+KONsqVuL48qYevbNiEnc91Gao9i7bu66
-LIJFcJ/OKLvPuIOXY5KDaCo8zo/RYD2uFJK4uauQVUltfnz9CM3bMxIZpChAipNW
-Crnwin6S9W9SGjJ8PY4kwRv7T9NBOsjP7YG3Zpb1YSETKug=
+MIIDEzCCAfugAwIBAgIJAKzzSET6l8Y/MA0GCSqGSIb3DQEBCwUAMCAxDjAMBgNV
+BAMMBWV4Y29uMQ4wDAYDVQQKDAVleGNvbjAeFw0xNjEyMDYxNjEyNDJaFw0xNzEy
+MDYxNjEyNDJaMCAxDjAMBgNVBAMMBWV4Y29uMQ4wDAYDVQQKDAVleGNvbjCCASIw
+DQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAPF0MdZTTHKniQSDGT2JDbGwk2/x
+6m2+cyym3uo4HYLRauG+lLA9N09vGpWsZxuvpHl//ViDoq+yPW5C/82YTQf+7k2O
+Uq7DVHaLbWU5B2AZJhcuKRy0g27m7z1mBL76wCgVVgC2we5/T7JCmhLMPZue29o7
+iGGC0axQQ1IdzW62CiKQqrWNPjJQL9LZdbX1s7TLcwSgje9byxFwq0g8uBp80heT
+/6SFWmr2kl3w+AlLgX7j5cojew6ko/urrE3+R0WyDILG1W0rDsFgPHfnXXDtYADp
+IRYvE/K+0ftpGeo/YrLXPhHXNzjuijw2L5MWgse4Pq/7Zx4nnOaYz6YcpaMCAwEA
+AaNQME4wHQYDVR0OBBYEFDZYNdQl4Zap5ZuyPDuv5hJruDvzMB8GA1UdIwQYMBaA
+FDZYNdQl4Zap5ZuyPDuv5hJruDvzMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEL
+BQADggEBAEKkNqpuOEClnC4aqXttjV+ExO6tqu3Q7cfDb9pmYEtmPNvhi5OIC9wD
+9bL4NAlytZtZ/obcO7sbhOE19kZbeUt5MdrmAfk2XtKOs6+n//FOhw/+sd1r2pT9
+jl/fAClxl6cRd9Adet13DbudLzkZuGLEzTYu4jjJ8xhwMH9zKgeYe9wL+aXKoAAr
+x5q+A9550ZqqPn336y2OTlv5o45qLaSV+YURhUgws4yYyJcnDnveSCKpqSecKOE9
+3Z+8l2FtMiyF4wZHscoEctNsCapxA6un3dzcC9T32906Wdur/QzA/6kKBQ88+Chm
+mFU1leOq2xBTXL0Rq0/44G06lR2Rts8=
 -----END CERTIFICATE-----
diff --git a/tests/data/excon.cert.key b/tests/data/excon.cert.key
index c28c0a0..f914495 100644
--- a/tests/data/excon.cert.key
+++ b/tests/data/excon.cert.key
@@ -1,15 +1,28 @@
------BEGIN RSA PRIVATE KEY-----
-MIICXQIBAAKBgQCjPn4I10H5DKXqRFkATu6SS0IKGGNBJ7WEoJhRf/RPn3KJAlgB
-7ZheUgbaW1iUc9wXGf236s2GJW0wFrt57F8LKf+hZ+Hb9Y71AK3gB90FeJ5vJFPB
-XKEPDtPOVK7hByA06WXnNoQS03FO3Q28QHTCS2UqZMYu+SPIgffjyhmH0QIDAQAB
-AoGACOChIgHyyIRzkWXeITIprzMAiGQDIcvzBx9kqSn4M0xMgj7qYlB1dMupK77D
-9m7GjUsQjSvruVvXsEHMODkugeqo/3pZWMj+WnXBtc+30Jfi1kzkTjk/dL0jG0hq
-rrb+10dS/jfhlUptgzG3tnDHOS1AqEhwH3zXSqn/AoNy5DECQQDV1f+1pGhLTf66
-6u9IJc6MZz5zw2avdk9O6qo6et+gmtq1FIpvw7S3zP8M0uOq0+g88PHQSgBeJ8BZ
-9YUWdH9XAkEAw264uoNVCpEpscfbGPRkDZXZE8nhmqhzkWBZAMcsqjdTcMdW0tVB
-8zdNSGg7GWM5svSKrJcx++Xxpyu1AftBFwJABvF77Bn6iPdvXgJi4qTXoBd6H6go
-nWnqCVX1URDMUhq1H0wbcqWYKJ+vaGswmUtoLxJjx6+fc282/7TJLYF64QJBAIbQ
-ZVw8ZriwZLu/61Mum6qHeUTeWePPWlGpzhvsSdJt8gB1cl5kQGdf+c7+H+6mdVIO
-wW7HqfJjsCyqyOXCBicCQQDS8aqD1iSfOi7J8DNrX1LnGudqdn+I7YITeQWZd07a
-uEiTDzuaxaDtvUrN+jS0I9K1Vnn2UQCwqhvFaARHzgVB
------END RSA PRIVATE KEY-----
+-----BEGIN PRIVATE KEY-----
+MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDxdDHWU0xyp4kE
+gxk9iQ2xsJNv8eptvnMspt7qOB2C0WrhvpSwPTdPbxqVrGcbr6R5f/1Yg6Kvsj1u
+Qv/NmE0H/u5NjlKuw1R2i21lOQdgGSYXLikctINu5u89ZgS++sAoFVYAtsHuf0+y
+QpoSzD2bntvaO4hhgtGsUENSHc1utgoikKq1jT4yUC/S2XW19bO0y3MEoI3vW8sR
+cKtIPLgafNIXk/+khVpq9pJd8PgJS4F+4+XKI3sOpKP7q6xN/kdFsgyCxtVtKw7B
+YDx3511w7WAA6SEWLxPyvtH7aRnqP2Ky1z4R1zc47oo8Ni+TFoLHuD6v+2ceJ5zm
+mM+mHKWjAgMBAAECggEBAKmprzdeEvLh3HrKMBs4SeIZJJDd2Y/B6qZun2bPhZUd
+2E/GHi705P+xH2oa2dzvf9BMalYfMVrqERaAh8UNBtvee88NefYJlTkzYexltVQG
+d+iD7CmaglyUc3meTSlxg0LnMyaPRRh0ZyjoeeFJmOTYLL5dZMi4JuNBBv0Vqfvn
+GzHE+7BBb935MBCOwfFO//TjzmcL2+DQVEsf6zOfhkEEFNTisorKJ2jq8OeLQnvL
+adm6H1bjmiR/W6vvTteW0wsKbI2zcua8kVErujKrQcdpbjf1rwXq9mAjsLoIcqd5
+BrHuzX8CRXljjG+H3A8v3uzHo0rkUrAa9EJ7v7BPPvkCgYEA+ekYm60RKbV6iOhR
+hzzc9Q/gpL2FjfYa8UB/9/THU10YTh9nXyZC880A+n8/yfxrJGhrm8HzD8AeaSTM
+ao0Rhte/vhWnuT+4KHdxyyRz8LF9qWTcwCoBxo8cRD10zRzVT2NEp63fOQfryKO9
+TcARLUba0qN502evE7V7paCn4S8CgYEA91ZY5zqfAFbfGimMpfz4Bzfgr8mDjKiQ
+AAP1xisOkBSsaV6aPlhrq49daNlFaAZ+xVX/t+82bxNBqHClkmCModJznLmO+iTb
+g94Ai+Vj4+tI+AENJVZYBw4z/B5aVpNeVXJ2yjDZVQJTYVLN8vUA8+1f4aztCS3D
+uzADX+7FHc0CgYA5C+yCHM9+Jd8CwYVayZnmlulAscJ61WLxDzgm8clOTkHuE10V
+azZ9UJ6Yj9OP1/7dILjvpSZGwiQu/CdtayZFEZrDWU4gC1uOYTWomXmdx+ZXdJ6v
+fudI3AIn0Z+H8rz+kjppzFbYPeaktjvQM7e4DiSFUKvOhiyA4zyGYlXwIQKBgDuO
+wkejuQfW41AkcybBHGR4kxUhPBkRueMXEQaP9ajCIaYZzqB2oC6mjgKiVvEupzYT
+eEktQ/lJNMU/os71iseoqogxsnkPiQBe49jL+tq2HFMDxcuY2AeS5vetw2kXgV6n
++mzDiIHM1pEX5Fm9n2YdYbow7r8IExqu/BEMqNB9AoGAHyody2FdY8oTZCNwFwZc
+4itxZa4ApQMSo+Pbs9vOpcR1bcxzORa1Bq79SI2jCZJJwST2YElMejLpV4g416HG
+PrWK+bRewLjSxWVWhbVVNSj8agBRfCgIish0BXcX4tZEVu6bsuwmyndf9uB96Xkn
+/lHu1mOeIUaSaDBlzBoaZks=
+-----END PRIVATE KEY-----
